<!DOCTYPE html>
<html>
<head>
    <title>Aplikasi Utang</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="m-5 mt-5">
    <h2>Catat Utang Baru</h2>
    <form action="/add" method="POST" class="mb-5">
      
      <% if (typeof error !== 'undefined') { %>
    <div class="alert alert-danger">
        <strong>Gagal:</strong> <%= error %>
    </div>
<% } %>

      
        <input type="text" name="namaPeminjam" placeholder="Nama Peminjam" class="form-control mb-2" required>
        <input type="text" name="keterangan" placeholder="Nama Barang (contoh: nabati, es)" class="form-control mb-2" required>
        <input type="number" name="jumlah" placeholder="Jumlah" class="form-control mb-2" required min="500">
        <button type="submit" class="btn btn-primary">Simpan</button>
    </form>

    <h2>Daftar Utang</h2>
    <div class="alert alert-info">
    <h4>Total Tagihan: Rp <%= totalUtang.toLocaleString() %></h4>
</div>

<form action="/" method="GET" class="d-flex mb-3">
    <input type="text" name="cari" class="form-control me-2" placeholder="Cari nama peminjam...">
    <button type="submit" class="btn btn-secondary">Cari</button>
    <a href="/" class="btn btn-outline-secondary ms-1">Reset</a>
</form>


    <table class="table">
        <thead>
            <tr>
                <th>Tanggal</th>
                <th>Nama</th>
                <th>Jumlah</th>
                <th>Status</th>
                <th>Aksi</th>
            </tr>
        </thead>
        <tbody>
            <% daftarUtang.forEach(u => { %>

            
            <tr>
            
            <td><%= new Date(u.createdAt).toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' }) %></td>

            
                <td>
    <strong><%= u.namaPeminjam %></strong><br>
    <small class="text-muted"><%= u.keterangan %></small>
</td>

                <td>Rp <%= u.jumlah.toLocaleString() %></td>
                <td><span class="badge <%= u.status === 'Lunas' ? 'bg-success' : 'bg-warning' %>"><%= u.status %></span></td>
              <td>
    <% if(u.status !== 'Lunas') { %>
        <form action="/update/<%= u._id %>" method="POST" style="display:inline;">
            <button class="btn btn-sm btn-success">Set Lunas</button>
        </form>
    <% } %>
    
    <form action="/delete/<%= u._id %>" method="POST" style="display:inline;" onsubmit="return confirm('Yakin ingin menghapus?')">
        <button class="btn btn-sm btn-danger">Hapus</button>
    </form>
</td>

            </tr>
            <% }) %>
        </tbody>
    </table>
</body>
</html>
